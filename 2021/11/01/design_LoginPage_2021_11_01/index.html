<!DOCTYPE html><html lang="zh-TW" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Login Page 设计演示01 | Arvin</title><meta name="keywords" content="设计"><meta name="author" content="Arvin"><meta name="copyright" content="Arvin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="分享大家一个好看的 Login Page 代码  演示图 演示代码&lt;!--    Developer: @Arvin    Explain: Login Page--&gt;&lt;!DOCTYPE html&gt;&lt;html lang&#x3D;&quot;zh-CN&quot;&gt;&lt;head&gt;    &lt;meta charset&#x3D;&quot;UTF-8&quot;&#x2F;&amp;gt">
<meta property="og:type" content="article">
<meta property="og:title" content="Login Page 设计演示01">
<meta property="og:url" content="https://arvinroad.github.io/2021/11/01/design_LoginPage_2021_11_01/index.html">
<meta property="og:site_name" content="Arvin">
<meta property="og:description" content="分享大家一个好看的 Login Page 代码  演示图 演示代码&lt;!--    Developer: @Arvin    Explain: Login Page--&gt;&lt;!DOCTYPE html&gt;&lt;html lang&#x3D;&quot;zh-CN&quot;&gt;&lt;head&gt;    &lt;meta charset&#x3D;&quot;UTF-8&quot;&#x2F;&amp;gt">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://z3.ax1x.com/2021/11/01/IpzNu9.jpg">
<meta property="article:published_time" content="2021-10-31T17:33:52.000Z">
<meta property="article:modified_time" content="2021-10-31T17:33:27.832Z">
<meta property="article:author" content="Arvin">
<meta property="article:tag" content="设计">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://z3.ax1x.com/2021/11/01/IpzNu9.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://arvinroad.github.io/2021/11/01/design_LoginPage_2021_11_01/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查詢的內容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"该文章创建于","messageNext":"天前，请以最新文章为准."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '複製成功',
    error: '複製錯誤',
    noSupport: '瀏覽器不支援'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '剛剛',
    min: '分鐘前',
    hour: '小時前',
    day: '天前',
    month: '個月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Arvin","link":"連結: ","source":"來源: Arvin","info":"著作權歸作者所有。商業轉載請聯絡作者獲得授權，非商業轉載請註明出處。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切換為繁體","cht_to_chs":"你已切換為簡體","day_to_night":"你已切換為深色模式","night_to_day":"你已切換為淺色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Login Page 设计演示01',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-01 01:33:27'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">載入中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head.jpg" onerror="onerror=null;src='./img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">57</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">標籤</div><div class="length-num">21</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分類</div><div class="length-num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 归档书屋</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 時間軸</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/books/"><i class="fa-fw fas fa-book-open"></i><span> 阅读</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 休闲室</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 電影</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 團隊成員</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://z3.ax1x.com/2021/11/01/IpzNu9.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Arvin</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜尋</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 归档书屋</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 時間軸</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/books/"><i class="fa-fw fas fa-book-open"></i><span> 阅读</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 休闲室</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 電影</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 團隊成員</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Login Page 设计演示01</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">發表於</span><time class="post-meta-date-created" datetime="2021-10-31T17:33:52.000Z" title="發表於 2021-11-01 01:33:52">2021-11-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新於</span><time class="post-meta-date-updated" datetime="2021-10-31T17:33:27.832Z" title="更新於 2021-11-01 01:33:27">2021-11-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web-Page/">Web Page</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Login Page 设计演示01"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">閱讀量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><strong>分享大家一个好看的 Login Page 代码</strong></p>
<hr>
<h3 id="演示图"><a href="#演示图" class="headerlink" title="演示图"></a>演示图</h3><p><img src="https://z3.ax1x.com/2021/11/01/IpzNu9.jpg"><br><img src="https://z3.ax1x.com/2021/11/01/IpzUBR.jpg"></p>
<h3 id="演示代码"><a href="#演示代码" class="headerlink" title="演示代码"></a>演示代码</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    Developer: @Arvin</span></span><br><span class="line"><span class="comment">    Explain: Login Page</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Login Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-tag">body</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#A7CFFF</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="css">            <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-tag">H1</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin-top</span>: <span class="number">38px</span>;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-tag">H1</span>,<span class="selector-tag">H2</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: <span class="number">#1F2029</span>;</span></span><br><span class="line"><span class="css">            user-select: none;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.switch</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#FCFBFA</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">width</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">height</span>: <span class="number">170px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="css">            <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin-left</span>: -<span class="number">200px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">top</span>: <span class="number">73%</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="comment">/* 选择同级后最近元素 @Arvin */</span></span></span><br><span class="line"><span class="css">        <span class="selector-id">#change</span><span class="selector-pseudo">:checked</span>+<span class="selector-tag">label</span>,</span></span><br><span class="line"><span class="css">        <span class="selector-id">#change</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:checked</span>)+<span class="selector-tag">label</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#ff5f99</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: <span class="number">#FCFBFA</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">width</span>: <span class="number">280px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="css">            <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">0</span>; <span class="comment">/* Padding 方便文字垂直居中显示 @Arvin */</span></span></span><br><span class="line"><span class="css">            <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">font-size</span>: <span class="number">24px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">font-weight</span>: <span class="number">600</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin-left</span>: -<span class="number">140px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">top</span>: <span class="number">82%</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border-radius</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="comment">/* 页面旋转模块 */</span></span></span><br><span class="line"><span class="css">        <span class="selector-class">.turn</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">width</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">height</span>: <span class="number">450px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">top</span>: <span class="number">8%</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="css">            <span class="attribute">perspective</span>: <span class="number">800px</span>; <span class="comment">/* 旋转时候的透视效果 @Arvin */</span></span></span><br><span class="line"><span class="css">            <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin-left</span>: -<span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.over</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">transition</span>: all <span class="number">1.6s</span> ease; <span class="comment">/* 旋转的持续时间 ease 是慢快慢 @Arvin */</span></span></span><br><span class="line"><span class="css">            <span class="attribute">transform-style</span>: preserve-<span class="number">3</span>d;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-id">#change</span><span class="selector-pseudo">:checked</span></span></span><br><span class="line"><span class="css">        ~</span></span><br><span class="line"><span class="css">        <span class="selector-class">.turn</span> <span class="selector-class">.over</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">transform</span>: <span class="built_in">rotateY</span>(<span class="number">180deg</span>);</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-tag">form</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="css">            <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border-radius</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#FCFBFA</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">transform-style</span>: preserve-<span class="number">3</span>d;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.sign</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">transform</span>: <span class="built_in">rotateY</span>(<span class="number">180deg</span>);</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-tag">input</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#4E495D</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">width</span>: <span class="number">70%</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">height</span>: <span class="number">48px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">16px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">font-weight</span>: <span class="number">500</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: <span class="number">#ff5f99</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">outline</span>: none;</span></span><br><span class="line"><span class="css">            <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="css">            <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">78</span>, <span class="number">73</span>, <span class="number">79</span>, .<span class="number">5</span>);</span></span><br><span class="line"><span class="css">            <span class="attribute">transform-style</span>: preserve-<span class="number">3</span>d;</span></span><br><span class="line"><span class="css">            <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1px</span>);</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="comment">/* 选择 Class 为 Login 的子元素中的前三个 input @Arvin */</span></span></span><br><span class="line"><span class="css">        <span class="selector-class">.login</span> <span class="selector-tag">input</span><span class="selector-pseudo">:nth-child</span>(-n+<span class="number">3</span>)&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.btn</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="attribute">background-color</span>: <span class="number">#981E61</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="css">            <span class="attribute">width</span>: <span class="number">280px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">font-weight</span>: <span class="number">600</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">color</span>: <span class="number">#FCFBFA</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">font-size</span>: <span class="number">24px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">padding</span>: <span class="number">6px</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">border-radius</span>: <span class="number">25px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="css">            <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="css">        &#125;</span></span><br><span class="line"><span class="css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 旋转开关 @Arvin --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;switch&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">H2</span>&gt;</span>没有/已有账户？<span class="tag">&lt;/<span class="name">H2</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;change&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;change&quot;</span>&gt;</span>切 换<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;turn&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;over&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">H1</span>&gt;</span>欢迎回来（＾－＾）<span class="tag">&lt;/<span class="name">H1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;passwirld&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登 录&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sign&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">H1</span>&gt;</span>加入我们（＾－＾）<span class="tag">&lt;/<span class="name">H1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;邮箱&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;passwirld&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;passwirld&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;确认密码&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;注册&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 樱花效果 来源于网上开源代码 @Arvin --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- partial:index.partial.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;sakura&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- sakura shader --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;sakura_point_vsh&quot;</span> <span class="attr">type</span>=<span class="string">&quot;x-shader/x_vertex&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  uniform mat4 uProjection;</span></span><br><span class="line"><span class="javascript">  uniform mat4 uModelview;</span></span><br><span class="line"><span class="javascript">  uniform vec3 uResolution;</span></span><br><span class="line"><span class="javascript">  uniform vec3 uOffset;</span></span><br><span class="line"><span class="javascript">  uniform vec3 uDOF;  <span class="comment">//x:focus distance, y:focus radius, z:max radius</span></span></span><br><span class="line"><span class="javascript">  uniform vec3 uFade; <span class="comment">//x:start distance, y:half distance, z:near fade start</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  attribute vec3 aPosition;</span></span><br><span class="line"><span class="javascript">  attribute vec3 aEuler;</span></span><br><span class="line"><span class="javascript">  attribute vec2 aMisc; <span class="comment">//x:size, y:fade</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  varying vec3 pposition;</span></span><br><span class="line"><span class="javascript">  varying float psize;</span></span><br><span class="line"><span class="javascript">  varying float palpha;</span></span><br><span class="line"><span class="javascript">  varying float pdist;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="comment">//varying mat3 rotMat;</span></span></span><br><span class="line"><span class="javascript">  varying vec3 normX;</span></span><br><span class="line"><span class="javascript">  varying vec3 normY;</span></span><br><span class="line"><span class="javascript">  varying vec3 normZ;</span></span><br><span class="line"><span class="javascript">  varying vec3 normal;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  varying float diffuse;</span></span><br><span class="line"><span class="javascript">  varying float specular;</span></span><br><span class="line"><span class="javascript">  varying float rstop;</span></span><br><span class="line"><span class="javascript">  varying float distancefade;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="keyword">void</span></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// Projection is based on vertical angle</span></span></span><br><span class="line"><span class="javascript">      vec4 pos = uModelview * vec4(aPosition + uOffset, <span class="number">1.0</span>);</span></span><br><span class="line"><span class="javascript">      gl_Position = uProjection * pos;</span></span><br><span class="line"><span class="javascript">      gl_PointSize = aMisc.x * uProjection[<span class="number">1</span>][<span class="number">1</span>] / -pos.z * uResolution.y * <span class="number">0.5</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      pposition = pos.xyz;</span></span><br><span class="line"><span class="javascript">      psize = aMisc.x;</span></span><br><span class="line"><span class="javascript">      pdist = length(pos.xyz);</span></span><br><span class="line"><span class="javascript">      palpha = smoothstep(<span class="number">0.0</span>, <span class="number">1.0</span>, (pdist - <span class="number">0.1</span>) / uFade.z);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      vec3 elrsn = sin(aEuler);</span></span><br><span class="line"><span class="javascript">      vec3 elrcs = cos(aEuler);</span></span><br><span class="line"><span class="javascript">      mat3 rotx = mat3(</span></span><br><span class="line"><span class="javascript">          <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>,</span></span><br><span class="line"><span class="javascript">          <span class="number">0.0</span>, elrcs.x, elrsn.x,</span></span><br><span class="line"><span class="javascript">          <span class="number">0.0</span>, -elrsn.x, elrcs.x</span></span><br><span class="line"><span class="javascript">      );</span></span><br><span class="line"><span class="javascript">      mat3 roty = mat3(</span></span><br><span class="line"><span class="javascript">          elrcs.y, <span class="number">0.0</span>, -elrsn.y,</span></span><br><span class="line"><span class="javascript">          <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>,</span></span><br><span class="line"><span class="javascript">          elrsn.y, <span class="number">0.0</span>, elrcs.y</span></span><br><span class="line"><span class="javascript">      );</span></span><br><span class="line"><span class="javascript">      mat3 rotz = mat3(</span></span><br><span class="line"><span class="javascript">          elrcs.z, elrsn.z, <span class="number">0.0</span>,</span></span><br><span class="line"><span class="javascript">          -elrsn.z, elrcs.z, <span class="number">0.0</span>,</span></span><br><span class="line"><span class="javascript">          <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span></span></span><br><span class="line"><span class="javascript">      );</span></span><br><span class="line"><span class="javascript">      mat3 rotmat = rotx * roty * rotz;</span></span><br><span class="line"><span class="javascript">      normal = rotmat[<span class="number">2</span>];</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      mat3 trrotm = mat3(</span></span><br><span class="line"><span class="javascript">          rotmat[<span class="number">0</span>][<span class="number">0</span>], rotmat[<span class="number">1</span>][<span class="number">0</span>], rotmat[<span class="number">2</span>][<span class="number">0</span>],</span></span><br><span class="line"><span class="javascript">          rotmat[<span class="number">0</span>][<span class="number">1</span>], rotmat[<span class="number">1</span>][<span class="number">1</span>], rotmat[<span class="number">2</span>][<span class="number">1</span>],</span></span><br><span class="line"><span class="javascript">          rotmat[<span class="number">0</span>][<span class="number">2</span>], rotmat[<span class="number">1</span>][<span class="number">2</span>], rotmat[<span class="number">2</span>][<span class="number">2</span>]</span></span><br><span class="line"><span class="javascript">      );</span></span><br><span class="line"><span class="javascript">      normX = trrotm[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">      normY = trrotm[<span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">      normZ = trrotm[<span class="number">2</span>];</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> vec3 lit = vec3(<span class="number">0.6917144638660746</span>, <span class="number">0.6917144638660746</span>, -<span class="number">0.20751433915982237</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      float tmpdfs = dot(lit, normal);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span>(tmpdfs &lt; <span class="number">0.0</span>) &#123;</span></span><br><span class="line"><span class="javascript">          normal = -normal;</span></span><br><span class="line"><span class="javascript">          tmpdfs = dot(lit, normal);</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">      diffuse = <span class="number">0.4</span> + tmpdfs;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      vec3 eyev = normalize(-pos.xyz);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span>(dot(eyev, normal) &gt; <span class="number">0.0</span>) &#123;</span></span><br><span class="line"><span class="javascript">          vec3 hv = normalize(eyev + lit);</span></span><br><span class="line"><span class="javascript">          specular = pow(max(dot(hv, normal), <span class="number">0.0</span>), <span class="number">20.0</span>);</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">          specular = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      rstop = clamp((abs(pdist - uDOF.x) - uDOF.y) / uDOF.z, <span class="number">0.0</span>, <span class="number">1.0</span>);</span></span><br><span class="line"><span class="javascript">      rstop = pow(rstop, <span class="number">0.5</span>);</span></span><br><span class="line"><span class="javascript">      <span class="comment">//-0.69315 = ln(0.5)</span></span></span><br><span class="line"><span class="javascript">      distancefade = min(<span class="number">1.0</span>, exp((uFade.x - pdist) * <span class="number">0.69315</span> / uFade.y));</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;sakura_point_fsh&quot;</span> <span class="attr">type</span>=<span class="string">&quot;x-shader/x_fragment&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  #ifdef GL_ES</span></span><br><span class="line"><span class="javascript">  <span class="comment">//precision mediump float;</span></span></span><br><span class="line"><span class="javascript">  precision highp float;</span></span><br><span class="line"><span class="javascript">  #endif</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  uniform vec3 uDOF;  <span class="comment">//x:focus distance, y:focus radius, z:max radius</span></span></span><br><span class="line"><span class="javascript">  uniform vec3 uFade; <span class="comment">//x:start distance, y:half distance, z:near fade start</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> vec3 fadeCol = vec3(<span class="number">0.08</span>, <span class="number">0.03</span>, <span class="number">0.06</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  varying vec3 pposition;</span></span><br><span class="line"><span class="javascript">  varying float psize;</span></span><br><span class="line"><span class="javascript">  varying float palpha;</span></span><br><span class="line"><span class="javascript">  varying float pdist;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="comment">//varying mat3 rotMat;</span></span></span><br><span class="line"><span class="javascript">  varying vec3 normX;</span></span><br><span class="line"><span class="javascript">  varying vec3 normY;</span></span><br><span class="line"><span class="javascript">  varying vec3 normZ;</span></span><br><span class="line"><span class="javascript">  varying vec3 normal;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  varying float diffuse;</span></span><br><span class="line"><span class="javascript">  varying float specular;</span></span><br><span class="line"><span class="javascript">  varying float rstop;</span></span><br><span class="line"><span class="javascript">  varying float distancefade;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  float <span class="function"><span class="title">ellipse</span>(<span class="params">vec2 p, vec2 o, vec2 r</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      vec2 lp = (p - o) / r;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> length(lp) - <span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="keyword">void</span></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      vec3 p = vec3(gl_PointCoord - vec2(<span class="number">0.5</span>, <span class="number">0.5</span>), <span class="number">0.0</span>) * <span class="number">2.0</span>;</span></span><br><span class="line"><span class="javascript">      vec3 d = vec3(<span class="number">0.0</span>, <span class="number">0.0</span>, -<span class="number">1.0</span>);</span></span><br><span class="line"><span class="javascript">      float nd = normZ.z; <span class="comment">//dot(-normZ, d);</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span>(abs(nd) &lt; <span class="number">0.0001</span>) discard;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      float np = dot(normZ, p);</span></span><br><span class="line"><span class="javascript">      vec3 tp = p + d * np / nd;</span></span><br><span class="line"><span class="javascript">      vec2 coord = vec2(dot(normX, tp), dot(normY, tp));</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">//angle = 15 degree</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> float flwrsn = <span class="number">0.258819045102521</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> float flwrcs = <span class="number">0.965925826289068</span>;</span></span><br><span class="line"><span class="javascript">      mat2 flwrm = mat2(flwrcs, -flwrsn, flwrsn, flwrcs);</span></span><br><span class="line"><span class="javascript">      vec2 flwrp = vec2(abs(coord.x), coord.y) * flwrm;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      float r;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span>(flwrp.x &lt; <span class="number">0.0</span>) &#123;</span></span><br><span class="line"><span class="javascript">          r = ellipse(flwrp, vec2(<span class="number">0.065</span>, <span class="number">0.024</span>) * <span class="number">0.5</span>, vec2(<span class="number">0.36</span>, <span class="number">0.96</span>) * <span class="number">0.5</span>);</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">          r = ellipse(flwrp, vec2(<span class="number">0.065</span>, <span class="number">0.024</span>) * <span class="number">0.5</span>, vec2(<span class="number">0.58</span>, <span class="number">0.96</span>) * <span class="number">0.5</span>);</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span>(r &gt; rstop) discard;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      vec3 col = mix(vec3(<span class="number">1.0</span>, <span class="number">0.8</span>, <span class="number">0.75</span>), vec3(<span class="number">1.0</span>, <span class="number">0.9</span>, <span class="number">0.87</span>), r);</span></span><br><span class="line"><span class="javascript">      float grady = mix(<span class="number">0.0</span>, <span class="number">1.0</span>, pow(coord.y * <span class="number">0.5</span> + <span class="number">0.5</span>, <span class="number">0.35</span>));</span></span><br><span class="line"><span class="javascript">      col *= vec3(<span class="number">1.0</span>, grady, grady);</span></span><br><span class="line"><span class="javascript">      col *= mix(<span class="number">0.8</span>, <span class="number">1.0</span>, pow(abs(coord.x), <span class="number">0.3</span>));</span></span><br><span class="line"><span class="javascript">      col = col * diffuse + specular;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      col = mix(fadeCol, col, distancefade);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      float alpha = (rstop &gt; <span class="number">0.001</span>)? (<span class="number">0.5</span> - r / (rstop * <span class="number">2.0</span>)) : <span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">      alpha = smoothstep(<span class="number">0.0</span>, <span class="number">1.0</span>, alpha) * palpha;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      gl_FragColor = vec4(col * <span class="number">0.5</span>, alpha);</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- effects --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;fx_common_vsh&quot;</span> <span class="attr">type</span>=<span class="string">&quot;x-shader/x_vertex&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  uniform vec3 uResolution;</span></span><br><span class="line"><span class="javascript">  attribute vec2 aPosition;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  varying vec2 texCoord;</span></span><br><span class="line"><span class="javascript">  varying vec2 screenCoord;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="keyword">void</span></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      gl_Position = vec4(aPosition, <span class="number">0.0</span>, <span class="number">1.0</span>);</span></span><br><span class="line"><span class="javascript">      texCoord = aPosition.xy * <span class="number">0.5</span> + vec2(<span class="number">0.5</span>, <span class="number">0.5</span>);</span></span><br><span class="line"><span class="javascript">      screenCoord = aPosition.xy * vec2(uResolution.z, <span class="number">1.0</span>);</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;bg_fsh&quot;</span> <span class="attr">type</span>=<span class="string">&quot;x-shader/x_fragment&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  #ifdef GL_ES</span></span><br><span class="line"><span class="javascript">  <span class="comment">//precision mediump float;</span></span></span><br><span class="line"><span class="javascript">  precision highp float;</span></span><br><span class="line"><span class="javascript">  #endif</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  uniform vec2 uTimes;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  varying vec2 texCoord;</span></span><br><span class="line"><span class="javascript">  varying vec2 screenCoord;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="keyword">void</span></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      vec3 col;</span></span><br><span class="line"><span class="javascript">      float c;</span></span><br><span class="line"><span class="javascript">      vec2 tmpv = texCoord * vec2(<span class="number">0.8</span>, <span class="number">1.0</span>) - vec2(<span class="number">0.95</span>, <span class="number">1.0</span>);</span></span><br><span class="line"><span class="javascript">      c = exp(-pow(length(tmpv) * <span class="number">1.8</span>, <span class="number">2.0</span>));</span></span><br><span class="line"><span class="javascript">      col = mix(vec3(<span class="number">0.02</span>, <span class="number">0.0</span>, <span class="number">0.03</span>), vec3(<span class="number">0.96</span>, <span class="number">0.98</span>, <span class="number">1.0</span>) * <span class="number">1.5</span>, c);</span></span><br><span class="line"><span class="javascript">      gl_FragColor = vec4(col * <span class="number">0.5</span>, <span class="number">1.0</span>);</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;fx_brightbuf_fsh&quot;</span> <span class="attr">type</span>=<span class="string">&quot;x-shader/x_fragment&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  #ifdef GL_ES</span></span><br><span class="line"><span class="javascript">  <span class="comment">//precision mediump float;</span></span></span><br><span class="line"><span class="javascript">  precision highp float;</span></span><br><span class="line"><span class="javascript">  #endif</span></span><br><span class="line"><span class="javascript">  uniform sampler2D uSrc;</span></span><br><span class="line"><span class="javascript">  uniform vec2 uDelta;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  varying vec2 texCoord;</span></span><br><span class="line"><span class="javascript">  varying vec2 screenCoord;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="keyword">void</span></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      vec4 col = texture2D(uSrc, texCoord);</span></span><br><span class="line"><span class="javascript">      gl_FragColor = vec4(col.rgb * <span class="number">2.0</span> - vec3(<span class="number">0.5</span>), <span class="number">1.0</span>);</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;fx_dirblur_r4_fsh&quot;</span> <span class="attr">type</span>=<span class="string">&quot;x-shader/x_fragment&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  #ifdef GL_ES</span></span><br><span class="line"><span class="javascript">  <span class="comment">//precision mediump float;</span></span></span><br><span class="line"><span class="javascript">  precision highp float;</span></span><br><span class="line"><span class="javascript">  #endif</span></span><br><span class="line"><span class="javascript">  uniform sampler2D uSrc;</span></span><br><span class="line"><span class="javascript">  uniform vec2 uDelta;</span></span><br><span class="line"><span class="javascript">  uniform vec4 uBlurDir; <span class="comment">//dir(x, y), stride(z, w)</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  varying vec2 texCoord;</span></span><br><span class="line"><span class="javascript">  varying vec2 screenCoord;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="keyword">void</span></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      vec4 col = texture2D(uSrc, texCoord);</span></span><br><span class="line"><span class="javascript">      col = col + texture2D(uSrc, texCoord + uBlurDir.xy * uDelta);</span></span><br><span class="line"><span class="javascript">      col = col + texture2D(uSrc, texCoord - uBlurDir.xy * uDelta);</span></span><br><span class="line"><span class="javascript">      col = col + texture2D(uSrc, texCoord + (uBlurDir.xy + uBlurDir.zw) * uDelta);</span></span><br><span class="line"><span class="javascript">      col = col + texture2D(uSrc, texCoord - (uBlurDir.xy + uBlurDir.zw) * uDelta);</span></span><br><span class="line"><span class="javascript">      gl_FragColor = col / <span class="number">5.0</span>;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- effect fragment shader template --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;fx_common_fsh&quot;</span> <span class="attr">type</span>=<span class="string">&quot;x-shader/x_fragment&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  #ifdef GL_ES</span></span><br><span class="line"><span class="javascript">  <span class="comment">//precision mediump float;</span></span></span><br><span class="line"><span class="javascript">  precision highp float;</span></span><br><span class="line"><span class="javascript">  #endif</span></span><br><span class="line"><span class="javascript">  uniform sampler2D uSrc;</span></span><br><span class="line"><span class="javascript">  uniform vec2 uDelta;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  varying vec2 texCoord;</span></span><br><span class="line"><span class="javascript">  varying vec2 screenCoord;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="keyword">void</span></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      gl_FragColor = texture2D(uSrc, texCoord);</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- post processing --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;pp_final_vsh&quot;</span> <span class="attr">type</span>=<span class="string">&quot;x-shader/x_vertex&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  uniform vec3 uResolution;</span></span><br><span class="line"><span class="javascript">  attribute vec2 aPosition;</span></span><br><span class="line"><span class="javascript">  varying vec2 texCoord;</span></span><br><span class="line"><span class="javascript">  varying vec2 screenCoord;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="keyword">void</span></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      gl_Position = vec4(aPosition, <span class="number">0.0</span>, <span class="number">1.0</span>);</span></span><br><span class="line"><span class="javascript">      texCoord = aPosition.xy * <span class="number">0.5</span> + vec2(<span class="number">0.5</span>, <span class="number">0.5</span>);</span></span><br><span class="line"><span class="javascript">      screenCoord = aPosition.xy * vec2(uResolution.z, <span class="number">1.0</span>);</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;pp_final_fsh&quot;</span> <span class="attr">type</span>=<span class="string">&quot;x-shader/x_fragment&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  #ifdef GL_ES</span></span><br><span class="line"><span class="javascript">  <span class="comment">//precision mediump float;</span></span></span><br><span class="line"><span class="javascript">  precision highp float;</span></span><br><span class="line"><span class="javascript">  #endif</span></span><br><span class="line"><span class="javascript">  uniform sampler2D uSrc;</span></span><br><span class="line"><span class="javascript">  uniform sampler2D uBloom;</span></span><br><span class="line"><span class="javascript">  uniform vec2 uDelta;</span></span><br><span class="line"><span class="javascript">  varying vec2 texCoord;</span></span><br><span class="line"><span class="javascript">  varying vec2 screenCoord;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="keyword">void</span></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      vec4 srccol = texture2D(uSrc, texCoord) * <span class="number">2.0</span>;</span></span><br><span class="line"><span class="javascript">      vec4 bloomcol = texture2D(uBloom, texCoord);</span></span><br><span class="line"><span class="javascript">      vec4 col;</span></span><br><span class="line"><span class="javascript">      col = srccol + bloomcol * (vec4(<span class="number">1.0</span>) + srccol);</span></span><br><span class="line"><span class="javascript">      col *= smoothstep(<span class="number">1.0</span>, <span class="number">0.0</span>, pow(length((texCoord - vec2(<span class="number">0.5</span>)) * <span class="number">2.0</span>), <span class="number">1.2</span>) * <span class="number">0.5</span>);</span></span><br><span class="line"><span class="javascript">      col = pow(col, vec4(<span class="number">0.45454545454545</span>)); <span class="comment">//(1.0 / 2.2)</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      gl_FragColor = vec4(col.rgb, <span class="number">1.0</span>);</span></span><br><span class="line"><span class="javascript">      gl_FragColor.a = <span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- partial --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// Utilities</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> Vector3 = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> Matrix44 = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">    Vector3.create = <span class="function"><span class="keyword">function</span>(<span class="params">x, y, z</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;<span class="string">&#x27;x&#x27;</span>:x, <span class="string">&#x27;y&#x27;</span>:y, <span class="string">&#x27;z&#x27;</span>:z&#125;;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript">    Vector3.dot = <span class="function"><span class="keyword">function</span> (<span class="params">v0, v1</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> v0.x * v1.x + v0.y * v1.y + v0.z * v1.z;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript">    Vector3.cross = <span class="function"><span class="keyword">function</span> (<span class="params">v, v0, v1</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        v.x = v0.y * v1.z - v0.z * v1.y;</span></span><br><span class="line"><span class="javascript">        v.y = v0.z * v1.x - v0.x * v1.z;</span></span><br><span class="line"><span class="javascript">        v.z = v0.x * v1.y - v0.y * v1.x;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript">    Vector3.normalize = <span class="function"><span class="keyword">function</span> (<span class="params">v</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> l = v.x * v.x + v.y * v.y + v.z * v.z;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(l &gt; <span class="number">0.00001</span>) &#123;</span></span><br><span class="line"><span class="javascript">            l = <span class="number">1.0</span> / <span class="built_in">Math</span>.sqrt(l);</span></span><br><span class="line"><span class="javascript">            v.x *= l;</span></span><br><span class="line"><span class="javascript">            v.y *= l;</span></span><br><span class="line"><span class="javascript">            v.z *= l;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript">    Vector3.arrayForm = <span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(v.array) &#123;</span></span><br><span class="line"><span class="javascript">            v.array[<span class="number">0</span>] = v.x;</span></span><br><span class="line"><span class="javascript">            v.array[<span class="number">1</span>] = v.y;</span></span><br><span class="line"><span class="javascript">            v.array[<span class="number">2</span>] = v.z;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            v.array = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([v.x, v.y, v.z]);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> v.array;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript">    Matrix44.createIdentity = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Float32Array</span>([<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>]);</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript">    Matrix44.loadProjection = <span class="function"><span class="keyword">function</span> (<span class="params">m, aspect, vdeg, near, far</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> h = near * <span class="built_in">Math</span>.tan(vdeg * <span class="built_in">Math</span>.PI / <span class="number">180.0</span> * <span class="number">0.5</span>) * <span class="number">2.0</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> w = h * aspect;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        m[<span class="number">0</span>] = <span class="number">2.0</span> * near / w;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">1</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">2</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">3</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        m[<span class="number">4</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">5</span>] = <span class="number">2.0</span> * near / h;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">6</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">7</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        m[<span class="number">8</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">9</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">10</span>] = -(far + near) / (far - near);</span></span><br><span class="line"><span class="javascript">        m[<span class="number">11</span>] = -<span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        m[<span class="number">12</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">13</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">14</span>] = -<span class="number">2.0</span> * far * near / (far - near);</span></span><br><span class="line"><span class="javascript">        m[<span class="number">15</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript">    Matrix44.loadLookAt = <span class="function"><span class="keyword">function</span> (<span class="params">m, vpos, vlook, vup</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> frontv = Vector3.create(vpos.x - vlook.x, vpos.y - vlook.y, vpos.z - vlook.z);</span></span><br><span class="line"><span class="javascript">        Vector3.normalize(frontv);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> sidev = Vector3.create(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span></span><br><span class="line"><span class="javascript">        Vector3.cross(sidev, vup, frontv);</span></span><br><span class="line"><span class="javascript">        Vector3.normalize(sidev);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> topv = Vector3.create(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span></span><br><span class="line"><span class="javascript">        Vector3.cross(topv, frontv, sidev);</span></span><br><span class="line"><span class="javascript">        Vector3.normalize(topv);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        m[<span class="number">0</span>] = sidev.x;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">1</span>] = topv.x;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">2</span>] = frontv.x;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">3</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        m[<span class="number">4</span>] = sidev.y;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">5</span>] = topv.y;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">6</span>] = frontv.y;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">7</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        m[<span class="number">8</span>] = sidev.z;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">9</span>] = topv.z;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">10</span>] = frontv.z;</span></span><br><span class="line"><span class="javascript">        m[<span class="number">11</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        m[<span class="number">12</span>] = -(vpos.x * m[<span class="number">0</span>] + vpos.y * m[<span class="number">4</span>] + vpos.z * m[<span class="number">8</span>]);</span></span><br><span class="line"><span class="javascript">        m[<span class="number">13</span>] = -(vpos.x * m[<span class="number">1</span>] + vpos.y * m[<span class="number">5</span>] + vpos.z * m[<span class="number">9</span>]);</span></span><br><span class="line"><span class="javascript">        m[<span class="number">14</span>] = -(vpos.x * m[<span class="number">2</span>] + vpos.y * m[<span class="number">6</span>] + vpos.z * m[<span class="number">10</span>]);</span></span><br><span class="line"><span class="javascript">        m[<span class="number">15</span>] = <span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> timeInfo = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;start&#x27;</span>:<span class="number">0</span>, <span class="string">&#x27;prev&#x27;</span>:<span class="number">0</span>, <span class="comment">// Date</span></span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;delta&#x27;</span>:<span class="number">0</span>, <span class="string">&#x27;elapsed&#x27;</span>:<span class="number">0</span> <span class="comment">// Number(sec)</span></span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> gl;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> renderSpec = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;width&#x27;</span>:<span class="number">0</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;height&#x27;</span>:<span class="number">0</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;aspect&#x27;</span>:<span class="number">1</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;array&#x27;</span>:<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="number">3</span>),</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;halfWidth&#x27;</span>:<span class="number">0</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;halfHeight&#x27;</span>:<span class="number">0</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;halfArray&#x27;</span>:<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="number">3</span>)</span></span><br><span class="line"><span class="javascript">        <span class="comment">// and some render targets. see setViewport()</span></span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript">    renderSpec.setSize = <span class="function"><span class="keyword">function</span>(<span class="params">w, h</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        renderSpec.width = w;</span></span><br><span class="line"><span class="javascript">        renderSpec.height = h;</span></span><br><span class="line"><span class="javascript">        renderSpec.aspect = renderSpec.width / renderSpec.height;</span></span><br><span class="line"><span class="javascript">        renderSpec.array[<span class="number">0</span>] = renderSpec.width;</span></span><br><span class="line"><span class="javascript">        renderSpec.array[<span class="number">1</span>] = renderSpec.height;</span></span><br><span class="line"><span class="javascript">        renderSpec.array[<span class="number">2</span>] = renderSpec.aspect;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        renderSpec.halfWidth = <span class="built_in">Math</span>.floor(w / <span class="number">2</span>);</span></span><br><span class="line"><span class="javascript">        renderSpec.halfHeight = <span class="built_in">Math</span>.floor(h / <span class="number">2</span>);</span></span><br><span class="line"><span class="javascript">        renderSpec.halfArray[<span class="number">0</span>] = renderSpec.halfWidth;</span></span><br><span class="line"><span class="javascript">        renderSpec.halfArray[<span class="number">1</span>] = renderSpec.halfHeight;</span></span><br><span class="line"><span class="javascript">        renderSpec.halfArray[<span class="number">2</span>] = renderSpec.halfWidth / renderSpec.halfHeight;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">deleteRenderTarget</span>(<span class="params">rt</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        gl.deleteFramebuffer(rt.frameBuffer);</span></span><br><span class="line"><span class="javascript">        gl.deleteRenderbuffer(rt.renderBuffer);</span></span><br><span class="line"><span class="javascript">        gl.deleteTexture(rt.texture);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">createRenderTarget</span>(<span class="params">w, h</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ret = &#123;</span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;width&#x27;</span>:w,</span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;height&#x27;</span>:h,</span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;sizeArray&#x27;</span>:<span class="keyword">new</span> <span class="built_in">Float32Array</span>([w, h, w / h]),</span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;dtxArray&#x27;</span>:<span class="keyword">new</span> <span class="built_in">Float32Array</span>([<span class="number">1.0</span> / w, <span class="number">1.0</span> / h])</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">        ret.frameBuffer = gl.createFramebuffer();</span></span><br><span class="line"><span class="javascript">        ret.renderBuffer = gl.createRenderbuffer();</span></span><br><span class="line"><span class="javascript">        ret.texture = gl.createTexture();</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.bindTexture(gl.TEXTURE_2D, ret.texture);</span></span><br><span class="line"><span class="javascript">        gl.texImage2D(gl.TEXTURE_2D, <span class="number">0</span>, gl.RGBA, w, h, <span class="number">0</span>, gl.RGBA, gl.UNSIGNED_BYTE, <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);</span></span><br><span class="line"><span class="javascript">        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);</span></span><br><span class="line"><span class="javascript">        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);</span></span><br><span class="line"><span class="javascript">        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.bindFramebuffer(gl.FRAMEBUFFER, ret.frameBuffer);</span></span><br><span class="line"><span class="javascript">        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, ret.texture, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.bindRenderbuffer(gl.RENDERBUFFER, ret.renderBuffer);</span></span><br><span class="line"><span class="javascript">        gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, w, h);</span></span><br><span class="line"><span class="javascript">        gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, ret.renderBuffer);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.bindTexture(gl.TEXTURE_2D, <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">        gl.bindRenderbuffer(gl.RENDERBUFFER, <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">        gl.bindFramebuffer(gl.FRAMEBUFFER, <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> ret;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">compileShader</span>(<span class="params">shtype, shsrc</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> retsh = gl.createShader(shtype);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.shaderSource(retsh, shsrc);</span></span><br><span class="line"><span class="javascript">        gl.compileShader(retsh);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(!gl.getShaderParameter(retsh, gl.COMPILE_STATUS)) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> errlog = gl.getShaderInfoLog(retsh);</span></span><br><span class="line"><span class="javascript">            gl.deleteShader(retsh);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.error(errlog);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> retsh;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">createShader</span>(<span class="params">vtxsrc, frgsrc, uniformlist, attrlist</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> vsh = compileShader(gl.VERTEX_SHADER, vtxsrc);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> fsh = compileShader(gl.FRAGMENT_SHADER, frgsrc);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(vsh == <span class="literal">null</span> || fsh == <span class="literal">null</span>) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> prog = gl.createProgram();</span></span><br><span class="line"><span class="javascript">        gl.attachShader(prog, vsh);</span></span><br><span class="line"><span class="javascript">        gl.attachShader(prog, fsh);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.deleteShader(vsh);</span></span><br><span class="line"><span class="javascript">        gl.deleteShader(fsh);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.linkProgram(prog);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (!gl.getProgramParameter(prog, gl.LINK_STATUS)) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> errlog = gl.getProgramInfoLog(prog);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.error(errlog);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(uniformlist) &#123;</span></span><br><span class="line"><span class="javascript">            prog.uniforms = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; uniformlist.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">                prog.uniforms[uniformlist[i]] = gl.getUniformLocation(prog, uniformlist[i]);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(attrlist) &#123;</span></span><br><span class="line"><span class="javascript">            prog.attributes = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; attrlist.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> attr = attrlist[i];</span></span><br><span class="line"><span class="javascript">                prog.attributes[attr] = gl.getAttribLocation(prog, attr);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> prog;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">useShader</span>(<span class="params">prog</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        gl.useProgram(prog);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> attr <span class="keyword">in</span> prog.attributes) &#123;</span></span><br><span class="line"><span class="javascript">            gl.enableVertexAttribArray(prog.attributes[attr]);;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">unuseShader</span>(<span class="params">prog</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> attr <span class="keyword">in</span> prog.attributes) &#123;</span></span><br><span class="line"><span class="javascript">            gl.disableVertexAttribArray(prog.attributes[attr]);;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        gl.useProgram(<span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">/////</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> projection = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;angle&#x27;</span>:<span class="number">60</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;nearfar&#x27;</span>:<span class="keyword">new</span> <span class="built_in">Float32Array</span>([<span class="number">0.1</span>, <span class="number">100.0</span>]),</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;matrix&#x27;</span>:Matrix44.createIdentity()</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> camera = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;position&#x27;</span>:Vector3.create(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>),</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;lookat&#x27;</span>:Vector3.create(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;up&#x27;</span>:Vector3.create(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>),</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;dof&#x27;</span>:Vector3.create(<span class="number">10.0</span>, <span class="number">4.0</span>, <span class="number">8.0</span>),</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;matrix&#x27;</span>:Matrix44.createIdentity()</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> pointFlower = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> meshFlower = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> sceneStandBy = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> BlossomParticle = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.velocity = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">3</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.rotation = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">3</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.position = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">3</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.euler = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">3</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.size = <span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.alpha = <span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.zkey = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    BlossomParticle.prototype.setVelocity = <span class="function"><span class="keyword">function</span> (<span class="params">vx, vy, vz</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.velocity[<span class="number">0</span>] = vx;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.velocity[<span class="number">1</span>] = vy;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.velocity[<span class="number">2</span>] = vz;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    BlossomParticle.prototype.setRotation = <span class="function"><span class="keyword">function</span> (<span class="params">rx, ry, rz</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.rotation[<span class="number">0</span>] = rx;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.rotation[<span class="number">1</span>] = ry;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.rotation[<span class="number">2</span>] = rz;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    BlossomParticle.prototype.setPosition = <span class="function"><span class="keyword">function</span> (<span class="params">nx, ny, nz</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.position[<span class="number">0</span>] = nx;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.position[<span class="number">1</span>] = ny;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.position[<span class="number">2</span>] = nz;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    BlossomParticle.prototype.setEulerAngles = <span class="function"><span class="keyword">function</span> (<span class="params">rx, ry, rz</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.euler[<span class="number">0</span>] = rx;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.euler[<span class="number">1</span>] = ry;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.euler[<span class="number">2</span>] = rz;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    BlossomParticle.prototype.setSize = <span class="function"><span class="keyword">function</span> (<span class="params">s</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.size = s;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    BlossomParticle.prototype.update = <span class="function"><span class="keyword">function</span> (<span class="params">dt, et</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.position[<span class="number">0</span>] += <span class="built_in">this</span>.velocity[<span class="number">0</span>] * dt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.position[<span class="number">1</span>] += <span class="built_in">this</span>.velocity[<span class="number">1</span>] * dt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.position[<span class="number">2</span>] += <span class="built_in">this</span>.velocity[<span class="number">2</span>] * dt;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.euler[<span class="number">0</span>] += <span class="built_in">this</span>.rotation[<span class="number">0</span>] * dt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.euler[<span class="number">1</span>] += <span class="built_in">this</span>.rotation[<span class="number">1</span>] * dt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.euler[<span class="number">2</span>] += <span class="built_in">this</span>.rotation[<span class="number">2</span>] * dt;</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">createPointFlowers</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// get point sizes</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> prm = gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE);</span></span><br><span class="line"><span class="javascript">        renderSpec.pointSize = &#123;<span class="string">&#x27;min&#x27;</span>:prm[<span class="number">0</span>], <span class="string">&#x27;max&#x27;</span>:prm[<span class="number">1</span>]&#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> vtxsrc = <span class="built_in">document</span>.getElementById(<span class="string">&quot;sakura_point_vsh&quot;</span>).textContent;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> frgsrc = <span class="built_in">document</span>.getElementById(<span class="string">&quot;sakura_point_fsh&quot;</span>).textContent;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        pointFlower.program = createShader(</span></span><br><span class="line"><span class="javascript">            vtxsrc, frgsrc,</span></span><br><span class="line"><span class="javascript">            [<span class="string">&#x27;uProjection&#x27;</span>, <span class="string">&#x27;uModelview&#x27;</span>, <span class="string">&#x27;uResolution&#x27;</span>, <span class="string">&#x27;uOffset&#x27;</span>, <span class="string">&#x27;uDOF&#x27;</span>, <span class="string">&#x27;uFade&#x27;</span>],</span></span><br><span class="line"><span class="javascript">            [<span class="string">&#x27;aPosition&#x27;</span>, <span class="string">&#x27;aEuler&#x27;</span>, <span class="string">&#x27;aMisc&#x27;</span>]</span></span><br><span class="line"><span class="javascript">        );</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        useShader(pointFlower.program);</span></span><br><span class="line"><span class="javascript">        pointFlower.offset = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]);</span></span><br><span class="line"><span class="javascript">        pointFlower.fader = Vector3.create(<span class="number">0.0</span>, <span class="number">10.0</span>, <span class="number">0.0</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// paramerters: velocity[3], rotate[3]</span></span></span><br><span class="line"><span class="javascript">        pointFlower.numFlowers = <span class="number">1600</span>;</span></span><br><span class="line"><span class="javascript">        pointFlower.particles = <span class="keyword">new</span> <span class="built_in">Array</span>(pointFlower.numFlowers);</span></span><br><span class="line"><span class="javascript">        <span class="comment">// vertex attributes &#123;position[3], euler_xyz[3], size[1]&#125;</span></span></span><br><span class="line"><span class="javascript">        pointFlower.dataArray = <span class="keyword">new</span> <span class="built_in">Float32Array</span>(pointFlower.numFlowers * (<span class="number">3</span> + <span class="number">3</span> + <span class="number">2</span>));</span></span><br><span class="line"><span class="javascript">        pointFlower.positionArrayOffset = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">        pointFlower.eulerArrayOffset = pointFlower.numFlowers * <span class="number">3</span>;</span></span><br><span class="line"><span class="javascript">        pointFlower.miscArrayOffset = pointFlower.numFlowers * <span class="number">6</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        pointFlower.buffer = gl.createBuffer();</span></span><br><span class="line"><span class="javascript">        gl.bindBuffer(gl.ARRAY_BUFFER, pointFlower.buffer);</span></span><br><span class="line"><span class="javascript">        gl.bufferData(gl.ARRAY_BUFFER, pointFlower.dataArray, gl.DYNAMIC_DRAW);</span></span><br><span class="line"><span class="javascript">        gl.bindBuffer(gl.ARRAY_BUFFER, <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        unuseShader(pointFlower.program);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pointFlower.numFlowers; i++) &#123;</span></span><br><span class="line"><span class="javascript">            pointFlower.particles[i] = <span class="keyword">new</span> BlossomParticle();</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">initPointFlowers</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//area</span></span></span><br><span class="line"><span class="javascript">        pointFlower.area = Vector3.create(<span class="number">20.0</span>, <span class="number">20.0</span>, <span class="number">20.0</span>);</span></span><br><span class="line"><span class="javascript">        pointFlower.area.x = pointFlower.area.y * renderSpec.aspect;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        pointFlower.fader.x = <span class="number">10.0</span>; <span class="comment">//env fade start</span></span></span><br><span class="line"><span class="javascript">        pointFlower.fader.y = pointFlower.area.z; <span class="comment">//env fade half</span></span></span><br><span class="line"><span class="javascript">        pointFlower.fader.z = <span class="number">0.1</span>;  <span class="comment">//near fade start</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//particles</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> PI2 = <span class="built_in">Math</span>.PI * <span class="number">2.0</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> tmpv3 = Vector3.create(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> tmpv = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> symmetryrand = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> (<span class="built_in">Math</span>.random() * <span class="number">2.0</span> - <span class="number">1.0</span>);&#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pointFlower.numFlowers; i++) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> tmpprtcl = pointFlower.particles[i];</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="comment">//velocity</span></span></span><br><span class="line"><span class="javascript">            tmpv3.x = symmetryrand() * <span class="number">0.3</span> + <span class="number">0.8</span>;</span></span><br><span class="line"><span class="javascript">            tmpv3.y = symmetryrand() * <span class="number">0.2</span> - <span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">            tmpv3.z = symmetryrand() * <span class="number">0.3</span> + <span class="number">0.5</span>;</span></span><br><span class="line"><span class="javascript">            Vector3.normalize(tmpv3);</span></span><br><span class="line"><span class="javascript">            tmpv = <span class="number">2.0</span> + <span class="built_in">Math</span>.random() * <span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">            tmpprtcl.setVelocity(tmpv3.x * tmpv, tmpv3.y * tmpv, tmpv3.z * tmpv);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="comment">//rotation</span></span></span><br><span class="line"><span class="javascript">            tmpprtcl.setRotation(</span></span><br><span class="line"><span class="javascript">                symmetryrand() * PI2 * <span class="number">0.5</span>,</span></span><br><span class="line"><span class="javascript">                symmetryrand() * PI2 * <span class="number">0.5</span>,</span></span><br><span class="line"><span class="javascript">                symmetryrand() * PI2 * <span class="number">0.5</span></span></span><br><span class="line"><span class="javascript">            );</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="comment">//position</span></span></span><br><span class="line"><span class="javascript">            tmpprtcl.setPosition(</span></span><br><span class="line"><span class="javascript">                symmetryrand() * pointFlower.area.x,</span></span><br><span class="line"><span class="javascript">                symmetryrand() * pointFlower.area.y,</span></span><br><span class="line"><span class="javascript">                symmetryrand() * pointFlower.area.z</span></span><br><span class="line"><span class="javascript">            );</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="comment">//euler</span></span></span><br><span class="line"><span class="javascript">            tmpprtcl.setEulerAngles(</span></span><br><span class="line"><span class="javascript">                <span class="built_in">Math</span>.random() * <span class="built_in">Math</span>.PI * <span class="number">2.0</span>,</span></span><br><span class="line"><span class="javascript">                <span class="built_in">Math</span>.random() * <span class="built_in">Math</span>.PI * <span class="number">2.0</span>,</span></span><br><span class="line"><span class="javascript">                <span class="built_in">Math</span>.random() * <span class="built_in">Math</span>.PI * <span class="number">2.0</span></span></span><br><span class="line"><span class="javascript">            );</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="comment">//size</span></span></span><br><span class="line"><span class="javascript">            tmpprtcl.setSize(<span class="number">0.9</span> + <span class="built_in">Math</span>.random() * <span class="number">0.1</span>);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">renderPointFlowers</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//update</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> PI2 = <span class="built_in">Math</span>.PI * <span class="number">2.0</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> limit = [pointFlower.area.x, pointFlower.area.y, pointFlower.area.z];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> repeatPos = <span class="function"><span class="keyword">function</span> (<span class="params">prt, cmp, limit</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(<span class="built_in">Math</span>.abs(prt.position[cmp]) - prt.size * <span class="number">0.5</span> &gt; limit) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//out of area</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(prt.position[cmp] &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">                    prt.position[cmp] -= limit * <span class="number">2.0</span>;</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                    prt.position[cmp] += limit * <span class="number">2.0</span>;</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> repeatEuler = <span class="function"><span class="keyword">function</span> (<span class="params">prt, cmp</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            prt.euler[cmp] = prt.euler[cmp] % PI2;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(prt.euler[cmp] &lt; <span class="number">0.0</span>) &#123;</span></span><br><span class="line"><span class="javascript">                prt.euler[cmp] += PI2;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pointFlower.numFlowers; i++) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> prtcl = pointFlower.particles[i];</span></span><br><span class="line"><span class="javascript">            prtcl.update(timeInfo.delta, timeInfo.elapsed);</span></span><br><span class="line"><span class="javascript">            repeatPos(prtcl, <span class="number">0</span>, pointFlower.area.x);</span></span><br><span class="line"><span class="javascript">            repeatPos(prtcl, <span class="number">1</span>, pointFlower.area.y);</span></span><br><span class="line"><span class="javascript">            repeatPos(prtcl, <span class="number">2</span>, pointFlower.area.z);</span></span><br><span class="line"><span class="javascript">            repeatEuler(prtcl, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">            repeatEuler(prtcl, <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">            repeatEuler(prtcl, <span class="number">2</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            prtcl.alpha = <span class="number">1.0</span>;<span class="comment">//(pointFlower.area.z - prtcl.position[2]) * 0.5;</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            prtcl.zkey = (camera.matrix[<span class="number">2</span>] * prtcl.position[<span class="number">0</span>]</span></span><br><span class="line"><span class="javascript">                + camera.matrix[<span class="number">6</span>] * prtcl.position[<span class="number">1</span>]</span></span><br><span class="line"><span class="javascript">                + camera.matrix[<span class="number">10</span>] * prtcl.position[<span class="number">2</span>]</span></span><br><span class="line"><span class="javascript">                + camera.matrix[<span class="number">14</span>]);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// sort</span></span></span><br><span class="line"><span class="javascript">        pointFlower.particles.sort(<span class="function"><span class="keyword">function</span>(<span class="params">p0, p1</span>)</span>&#123;<span class="keyword">return</span> p0.zkey - p1.zkey;&#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// update data</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ipos = pointFlower.positionArrayOffset;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ieuler = pointFlower.eulerArrayOffset;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> imisc = pointFlower.miscArrayOffset;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pointFlower.numFlowers; i++) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> prtcl = pointFlower.particles[i];</span></span><br><span class="line"><span class="javascript">            pointFlower.dataArray[ipos] = prtcl.position[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">            pointFlower.dataArray[ipos + <span class="number">1</span>] = prtcl.position[<span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">            pointFlower.dataArray[ipos + <span class="number">2</span>] = prtcl.position[<span class="number">2</span>];</span></span><br><span class="line"><span class="javascript">            ipos += <span class="number">3</span>;</span></span><br><span class="line"><span class="javascript">            pointFlower.dataArray[ieuler] = prtcl.euler[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">            pointFlower.dataArray[ieuler + <span class="number">1</span>] = prtcl.euler[<span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">            pointFlower.dataArray[ieuler + <span class="number">2</span>] = prtcl.euler[<span class="number">2</span>];</span></span><br><span class="line"><span class="javascript">            ieuler += <span class="number">3</span>;</span></span><br><span class="line"><span class="javascript">            pointFlower.dataArray[imisc] = prtcl.size;</span></span><br><span class="line"><span class="javascript">            pointFlower.dataArray[imisc + <span class="number">1</span>] = prtcl.alpha;</span></span><br><span class="line"><span class="javascript">            imisc += <span class="number">2</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//draw</span></span></span><br><span class="line"><span class="javascript">        gl.enable(gl.BLEND);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//gl.disable(gl.DEPTH_TEST);</span></span></span><br><span class="line"><span class="javascript">        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> prog = pointFlower.program;</span></span><br><span class="line"><span class="javascript">        useShader(prog);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.uniformMatrix4fv(prog.uniforms.uProjection, <span class="literal">false</span>, projection.matrix);</span></span><br><span class="line"><span class="javascript">        gl.uniformMatrix4fv(prog.uniforms.uModelview, <span class="literal">false</span>, camera.matrix);</span></span><br><span class="line"><span class="javascript">        gl.uniform3fv(prog.uniforms.uResolution, renderSpec.array);</span></span><br><span class="line"><span class="javascript">        gl.uniform3fv(prog.uniforms.uDOF, Vector3.arrayForm(camera.dof));</span></span><br><span class="line"><span class="javascript">        gl.uniform3fv(prog.uniforms.uFade, Vector3.arrayForm(pointFlower.fader));</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.bindBuffer(gl.ARRAY_BUFFER, pointFlower.buffer);</span></span><br><span class="line"><span class="javascript">        gl.bufferData(gl.ARRAY_BUFFER, pointFlower.dataArray, gl.DYNAMIC_DRAW);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.vertexAttribPointer(prog.attributes.aPosition, <span class="number">3</span>, gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, pointFlower.positionArrayOffset * <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT);</span></span><br><span class="line"><span class="javascript">        gl.vertexAttribPointer(prog.attributes.aEuler, <span class="number">3</span>, gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, pointFlower.eulerArrayOffset * <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT);</span></span><br><span class="line"><span class="javascript">        gl.vertexAttribPointer(prog.attributes.aMisc, <span class="number">2</span>, gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, pointFlower.miscArrayOffset * <span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// doubler</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; <span class="number">2</span>; i++) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> zpos = i * -<span class="number">2.0</span>;</span></span><br><span class="line"><span class="javascript">            pointFlower.offset[<span class="number">0</span>] = pointFlower.area.x * -<span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">            pointFlower.offset[<span class="number">1</span>] = pointFlower.area.y * -<span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">            pointFlower.offset[<span class="number">2</span>] = pointFlower.area.z * zpos;</span></span><br><span class="line"><span class="javascript">            gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);</span></span><br><span class="line"><span class="javascript">            gl.drawArrays(gl.POINT, <span class="number">0</span>, pointFlower.numFlowers);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            pointFlower.offset[<span class="number">0</span>] = pointFlower.area.x * -<span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">            pointFlower.offset[<span class="number">1</span>] = pointFlower.area.y *  <span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">            pointFlower.offset[<span class="number">2</span>] = pointFlower.area.z * zpos;</span></span><br><span class="line"><span class="javascript">            gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);</span></span><br><span class="line"><span class="javascript">            gl.drawArrays(gl.POINT, <span class="number">0</span>, pointFlower.numFlowers);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            pointFlower.offset[<span class="number">0</span>] = pointFlower.area.x *  <span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">            pointFlower.offset[<span class="number">1</span>] = pointFlower.area.y * -<span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">            pointFlower.offset[<span class="number">2</span>] = pointFlower.area.z * zpos;</span></span><br><span class="line"><span class="javascript">            gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);</span></span><br><span class="line"><span class="javascript">            gl.drawArrays(gl.POINT, <span class="number">0</span>, pointFlower.numFlowers);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            pointFlower.offset[<span class="number">0</span>] = pointFlower.area.x *  <span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">            pointFlower.offset[<span class="number">1</span>] = pointFlower.area.y *  <span class="number">1.0</span>;</span></span><br><span class="line"><span class="javascript">            pointFlower.offset[<span class="number">2</span>] = pointFlower.area.z * zpos;</span></span><br><span class="line"><span class="javascript">            gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);</span></span><br><span class="line"><span class="javascript">            gl.drawArrays(gl.POINT, <span class="number">0</span>, pointFlower.numFlowers);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//main</span></span></span><br><span class="line"><span class="javascript">        pointFlower.offset[<span class="number">0</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">        pointFlower.offset[<span class="number">1</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">        pointFlower.offset[<span class="number">2</span>] = <span class="number">0.0</span>;</span></span><br><span class="line"><span class="javascript">        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);</span></span><br><span class="line"><span class="javascript">        gl.drawArrays(gl.POINT, <span class="number">0</span>, pointFlower.numFlowers);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.bindBuffer(gl.ARRAY_BUFFER, <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">        unuseShader(prog);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.enable(gl.DEPTH_TEST);</span></span><br><span class="line"><span class="javascript">        gl.disable(gl.BLEND);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// effects</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//common util</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">createEffectProgram</span>(<span class="params">vtxsrc, frgsrc, exunifs, exattrs</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ret = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> unifs = [<span class="string">&#x27;uResolution&#x27;</span>, <span class="string">&#x27;uSrc&#x27;</span>, <span class="string">&#x27;uDelta&#x27;</span>];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(exunifs) &#123;</span></span><br><span class="line"><span class="javascript">            unifs = unifs.concat(exunifs);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> attrs = [<span class="string">&#x27;aPosition&#x27;</span>];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(exattrs) &#123;</span></span><br><span class="line"><span class="javascript">            attrs = attrs.concat(exattrs);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        ret.program = createShader(vtxsrc, frgsrc, unifs, attrs);</span></span><br><span class="line"><span class="javascript">        useShader(ret.program);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        ret.dataArray = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span></span><br><span class="line"><span class="javascript">            -<span class="number">1.0</span>, -<span class="number">1.0</span>,</span></span><br><span class="line"><span class="javascript">            <span class="number">1.0</span>, -<span class="number">1.0</span>,</span></span><br><span class="line"><span class="javascript">            -<span class="number">1.0</span>,  <span class="number">1.0</span>,</span></span><br><span class="line"><span class="javascript">            <span class="number">1.0</span>,  <span class="number">1.0</span></span></span><br><span class="line"><span class="javascript">        ]);</span></span><br><span class="line"><span class="javascript">        ret.buffer = gl.createBuffer();</span></span><br><span class="line"><span class="javascript">        gl.bindBuffer(gl.ARRAY_BUFFER, ret.buffer);</span></span><br><span class="line"><span class="javascript">        gl.bufferData(gl.ARRAY_BUFFER, ret.dataArray, gl.STATIC_DRAW);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.bindBuffer(gl.ARRAY_BUFFER, <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">        unuseShader(ret.program);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> ret;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// basic usage</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// useEffect(prog, srctex(&#123;&#x27;texture&#x27;:texid, &#x27;dtxArray&#x27;:(f32)[dtx, dty]&#125;)); //basic initialize</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// gl.uniform**(...); //additional uniforms</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// drawEffect()</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// unuseEffect(prog)</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// TEXTURE0 makes src</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">useEffect</span>(<span class="params">fxobj, srctex</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> prog = fxobj.program;</span></span><br><span class="line"><span class="javascript">        useShader(prog);</span></span><br><span class="line"><span class="javascript">        gl.uniform3fv(prog.uniforms.uResolution, renderSpec.array);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(srctex != <span class="literal">null</span>) &#123;</span></span><br><span class="line"><span class="javascript">            gl.uniform2fv(prog.uniforms.uDelta, srctex.dtxArray);</span></span><br><span class="line"><span class="javascript">            gl.uniform1i(prog.uniforms.uSrc, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            gl.activeTexture(gl.TEXTURE0);</span></span><br><span class="line"><span class="javascript">            gl.bindTexture(gl.TEXTURE_2D, srctex.texture);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">drawEffect</span>(<span class="params">fxobj</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        gl.bindBuffer(gl.ARRAY_BUFFER, fxobj.buffer);</span></span><br><span class="line"><span class="javascript">        gl.vertexAttribPointer(fxobj.program.attributes.aPosition, <span class="number">2</span>, gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">        gl.drawArrays(gl.TRIANGLE_STRIP, <span class="number">0</span>, <span class="number">4</span>);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">unuseEffect</span>(<span class="params">fxobj</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        unuseShader(fxobj.program);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> effectLib = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">createEffectLib</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> vtxsrc, frgsrc;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//common</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> cmnvtxsrc = <span class="built_in">document</span>.getElementById(<span class="string">&quot;fx_common_vsh&quot;</span>).textContent;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//background</span></span></span><br><span class="line"><span class="javascript">        frgsrc = <span class="built_in">document</span>.getElementById(<span class="string">&quot;bg_fsh&quot;</span>).textContent;</span></span><br><span class="line"><span class="javascript">        effectLib.sceneBg = createEffectProgram(cmnvtxsrc, frgsrc, [<span class="string">&#x27;uTimes&#x27;</span>], <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// make brightpixels buffer</span></span></span><br><span class="line"><span class="javascript">        frgsrc = <span class="built_in">document</span>.getElementById(<span class="string">&quot;fx_brightbuf_fsh&quot;</span>).textContent;</span></span><br><span class="line"><span class="javascript">        effectLib.mkBrightBuf = createEffectProgram(cmnvtxsrc, frgsrc, <span class="literal">null</span>, <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// direction blur</span></span></span><br><span class="line"><span class="javascript">        frgsrc = <span class="built_in">document</span>.getElementById(<span class="string">&quot;fx_dirblur_r4_fsh&quot;</span>).textContent;</span></span><br><span class="line"><span class="javascript">        effectLib.dirBlur = createEffectProgram(cmnvtxsrc, frgsrc, [<span class="string">&#x27;uBlurDir&#x27;</span>], <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//final composite</span></span></span><br><span class="line"><span class="javascript">        vtxsrc = <span class="built_in">document</span>.getElementById(<span class="string">&quot;pp_final_vsh&quot;</span>).textContent;</span></span><br><span class="line"><span class="javascript">        frgsrc = <span class="built_in">document</span>.getElementById(<span class="string">&quot;pp_final_fsh&quot;</span>).textContent;</span></span><br><span class="line"><span class="javascript">        effectLib.finalComp = createEffectProgram(vtxsrc, frgsrc, [<span class="string">&#x27;uBloom&#x27;</span>], <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// background</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">createBackground</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//console.log(&quot;create background&quot;);</span></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">initBackground</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//console.log(&quot;init background&quot;);</span></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">renderBackground</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        gl.disable(gl.DEPTH_TEST);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        useEffect(effectLib.sceneBg, <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">        gl.uniform2f(effectLib.sceneBg.program.uniforms.uTimes, timeInfo.elapsed, timeInfo.delta);</span></span><br><span class="line"><span class="javascript">        drawEffect(effectLib.sceneBg);</span></span><br><span class="line"><span class="javascript">        unuseEffect(effectLib.sceneBg);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.enable(gl.DEPTH_TEST);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// post process</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> postProcess = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">createPostProcess</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//console.log(&quot;create post process&quot;);</span></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">initPostProcess</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//console.log(&quot;init post process&quot;);</span></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">renderPostProcess</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        gl.enable(gl.TEXTURE_2D);</span></span><br><span class="line"><span class="javascript">        gl.disable(gl.DEPTH_TEST);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> bindRT = <span class="function"><span class="keyword">function</span> (<span class="params">rt, isclear</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            gl.bindFramebuffer(gl.FRAMEBUFFER, rt.frameBuffer);</span></span><br><span class="line"><span class="javascript">            gl.viewport(<span class="number">0</span>, <span class="number">0</span>, rt.width, rt.height);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(isclear) &#123;</span></span><br><span class="line"><span class="javascript">                gl.clearColor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">                gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//make bright buff</span></span></span><br><span class="line"><span class="javascript">        bindRT(renderSpec.wHalfRT0, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">        useEffect(effectLib.mkBrightBuf, renderSpec.mainRT);</span></span><br><span class="line"><span class="javascript">        drawEffect(effectLib.mkBrightBuf);</span></span><br><span class="line"><span class="javascript">        unuseEffect(effectLib.mkBrightBuf);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// make bloom</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> p = <span class="number">1.5</span> + <span class="number">1</span> * i;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> s = <span class="number">2.0</span> + <span class="number">1</span> * i;</span></span><br><span class="line"><span class="javascript">            bindRT(renderSpec.wHalfRT1, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">            useEffect(effectLib.dirBlur, renderSpec.wHalfRT0);</span></span><br><span class="line"><span class="javascript">            gl.uniform4f(effectLib.dirBlur.program.uniforms.uBlurDir, p, <span class="number">0.0</span>, s, <span class="number">0.0</span>);</span></span><br><span class="line"><span class="javascript">            drawEffect(effectLib.dirBlur);</span></span><br><span class="line"><span class="javascript">            unuseEffect(effectLib.dirBlur);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            bindRT(renderSpec.wHalfRT0, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">            useEffect(effectLib.dirBlur, renderSpec.wHalfRT1);</span></span><br><span class="line"><span class="javascript">            gl.uniform4f(effectLib.dirBlur.program.uniforms.uBlurDir, <span class="number">0.0</span>, p, <span class="number">0.0</span>, s);</span></span><br><span class="line"><span class="javascript">            drawEffect(effectLib.dirBlur);</span></span><br><span class="line"><span class="javascript">            unuseEffect(effectLib.dirBlur);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//display</span></span></span><br><span class="line"><span class="javascript">        gl.bindFramebuffer(gl.FRAMEBUFFER, <span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">        gl.viewport(<span class="number">0</span>, <span class="number">0</span>, renderSpec.width, renderSpec.height);</span></span><br><span class="line"><span class="javascript">        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        useEffect(effectLib.finalComp, renderSpec.mainRT);</span></span><br><span class="line"><span class="javascript">        gl.uniform1i(effectLib.finalComp.program.uniforms.uBloom, <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">        gl.activeTexture(gl.TEXTURE1);</span></span><br><span class="line"><span class="javascript">        gl.bindTexture(gl.TEXTURE_2D, renderSpec.wHalfRT0.texture);</span></span><br><span class="line"><span class="javascript">        drawEffect(effectLib.finalComp);</span></span><br><span class="line"><span class="javascript">        unuseEffect(effectLib.finalComp);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.enable(gl.DEPTH_TEST);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">/////</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> SceneEnv = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">createScene</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        createEffectLib();</span></span><br><span class="line"><span class="javascript">        createBackground();</span></span><br><span class="line"><span class="javascript">        createPointFlowers();</span></span><br><span class="line"><span class="javascript">        createPostProcess();</span></span><br><span class="line"><span class="javascript">        sceneStandBy = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">initScene</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        initBackground();</span></span><br><span class="line"><span class="javascript">        initPointFlowers();</span></span><br><span class="line"><span class="javascript">        initPostProcess();</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//camera.position.z = 17.320508;</span></span></span><br><span class="line"><span class="javascript">        camera.position.z = pointFlower.area.z + projection.nearfar[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">        projection.angle = <span class="built_in">Math</span>.atan2(pointFlower.area.y, camera.position.z + pointFlower.area.z) * <span class="number">180.0</span> / <span class="built_in">Math</span>.PI * <span class="number">2.0</span>;</span></span><br><span class="line"><span class="javascript">        Matrix44.loadProjection(projection.matrix, renderSpec.aspect, projection.angle, projection.nearfar[<span class="number">0</span>], projection.nearfar[<span class="number">1</span>]);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">renderScene</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//draw</span></span></span><br><span class="line"><span class="javascript">        Matrix44.loadLookAt(camera.matrix, camera.position, camera.lookat, camera.up);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.enable(gl.DEPTH_TEST);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//gl.bindFramebuffer(gl.FRAMEBUFFER, null);</span></span></span><br><span class="line"><span class="javascript">        gl.bindFramebuffer(gl.FRAMEBUFFER, renderSpec.mainRT.frameBuffer);</span></span><br><span class="line"><span class="javascript">        gl.viewport(<span class="number">0</span>, <span class="number">0</span>, renderSpec.mainRT.width, renderSpec.mainRT.height);</span></span><br><span class="line"><span class="javascript">        gl.clearColor(<span class="number">0.005</span>, <span class="number">0</span>, <span class="number">0.05</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        renderBackground();</span></span><br><span class="line"><span class="javascript">        renderPointFlowers();</span></span><br><span class="line"><span class="javascript">        renderPostProcess();</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">onResize</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        makeCanvasFullScreen(<span class="built_in">document</span>.getElementById(<span class="string">&quot;sakura&quot;</span>));</span></span><br><span class="line"><span class="javascript">        setViewports();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(sceneStandBy) &#123;</span></span><br><span class="line"><span class="javascript">            initScene();</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">setViewports</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        renderSpec.setSize(gl.canvas.width, gl.canvas.height);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        gl.clearColor(<span class="number">0.2</span>, <span class="number">0.2</span>, <span class="number">0.5</span>, <span class="number">1.0</span>);</span></span><br><span class="line"><span class="javascript">        gl.viewport(<span class="number">0</span>, <span class="number">0</span>, renderSpec.width, renderSpec.height);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> rtfunc = <span class="function"><span class="keyword">function</span> (<span class="params">rtname, rtw, rth</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> rt = renderSpec[rtname];</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(rt) deleteRenderTarget(rt);</span></span><br><span class="line"><span class="javascript">            renderSpec[rtname] = createRenderTarget(rtw, rth);</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">        rtfunc(<span class="string">&#x27;mainRT&#x27;</span>, renderSpec.width, renderSpec.height);</span></span><br><span class="line"><span class="javascript">        rtfunc(<span class="string">&#x27;wFullRT0&#x27;</span>, renderSpec.width, renderSpec.height);</span></span><br><span class="line"><span class="javascript">        rtfunc(<span class="string">&#x27;wFullRT1&#x27;</span>, renderSpec.width, renderSpec.height);</span></span><br><span class="line"><span class="javascript">        rtfunc(<span class="string">&#x27;wHalfRT0&#x27;</span>, renderSpec.halfWidth, renderSpec.halfHeight);</span></span><br><span class="line"><span class="javascript">        rtfunc(<span class="string">&#x27;wHalfRT1&#x27;</span>, renderSpec.halfWidth, renderSpec.halfHeight);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        renderScene();</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> animating = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">stepAnimation</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(!animating) animate();</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> curdate = <span class="keyword">new</span> <span class="built_in">Date</span>();</span></span><br><span class="line"><span class="javascript">        timeInfo.elapsed = (curdate - timeInfo.start) / <span class="number">1000.0</span>;</span></span><br><span class="line"><span class="javascript">        timeInfo.delta = (curdate - timeInfo.prev) / <span class="number">1000.0</span>;</span></span><br><span class="line"><span class="javascript">        timeInfo.prev = curdate;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(animating) requestAnimationFrame(animate);</span></span><br><span class="line"><span class="javascript">        render();</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">makeCanvasFullScreen</span>(<span class="params">canvas</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> b = <span class="built_in">document</span>.body;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> d = <span class="built_in">document</span>.documentElement;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> fullw = <span class="built_in">Math</span>.max(b.clientWidth , b.scrollWidth, d.scrollWidth, d.clientWidth);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> fullh = <span class="built_in">Math</span>.max(b.clientHeight , b.scrollHeight, d.scrollHeight, d.clientHeight);</span></span><br><span class="line"><span class="javascript">        canvas.width = fullw;</span></span><br><span class="line"><span class="javascript">        canvas.height = fullh;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;load&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">&quot;sakura&quot;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="javascript">            makeCanvasFullScreen(canvas);</span></span><br><span class="line"><span class="javascript">            gl = canvas.getContext(<span class="string">&#x27;experimental-webgl&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">catch</span>(e) &#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">&quot;WebGL not supported.&quot;</span> + e);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.error(e);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;resize&#x27;</span>, onResize);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        setViewports();</span></span><br><span class="line"><span class="javascript">        createScene();</span></span><br><span class="line"><span class="javascript">        initScene();</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        timeInfo.start = <span class="keyword">new</span> <span class="built_in">Date</span>();</span></span><br><span class="line"><span class="javascript">        timeInfo.prev = timeInfo.start;</span></span><br><span class="line"><span class="javascript">        animate();</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//set window.requestAnimationFrame</span></span></span><br><span class="line"><span class="javascript">    (<span class="function"><span class="keyword">function</span> (<span class="params">w, r</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        w[<span class="string">&#x27;r&#x27;</span>+r] = w[<span class="string">&#x27;r&#x27;</span>+r] || w[<span class="string">&#x27;webkitR&#x27;</span>+r] || w[<span class="string">&#x27;mozR&#x27;</span>+r] || w[<span class="string">&#x27;msR&#x27;</span>+r] || w[<span class="string">&#x27;oR&#x27;</span>+r] || <span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123; w.setTimeout(c, <span class="number">1000</span> / <span class="number">60</span>); &#125;;</span></span><br><span class="line"><span class="javascript">    &#125;)(<span class="built_in">window</span>, <span class="string">&#x27;requestAnimationFrame&#x27;</span>);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/ArvinRoad">Arvin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章連結: </span><span class="post-copyright-info"><a href="https://arvinroad.github.io/2021/11/01/design_LoginPage_2021_11_01/">https://arvinroad.github.io/2021/11/01/design_LoginPage_2021_11_01/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版權聲明: </span><span class="post-copyright-info">此文章版權歸Arvin所有，如有轉載，請註明來自原作者</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%BE%E8%AE%A1/">设计</a></div><div class="post_share"><div class="social-share" data-image="https://z3.ax1x.com/2021/11/01/IpzNu9.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/11/05/CodeGame_Java_SuperMary_Test01/"><img class="prev-cover" src="https://tse3-mm.cn.bing.net/th/id/OIP-C.mRQUEYkDCy0aqlsBtq54zwHaJg?pid=ImgDet&amp;rs=1" onerror="onerror=null;src='/./img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java 创建窗口</div></div></a></div><div class="next-post pull-right"><a href="/2021/10/31/design_ErrorPage_2021_10_31/"><img class="next-cover" src="https://z3.ax1x.com/2021/10/31/5z70Rx.png" onerror="onerror=null;src='/./img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Error Page 设计演示01</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相關推薦</span></div><div class="relatedPosts-list"><div><a href="/2021/10/31/design_404Page_2021_10_31/" title="404 Page 设计演示01"><img class="cover" src="https://z3.ax1x.com/2021/10/31/5zTL26.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-31</div><div class="title">404 Page 设计演示01</div></div></a></div><div><a href="/2021/10/31/design_ErrorPage_2021_10_31/" title="Error Page 设计演示01"><img class="cover" src="https://z3.ax1x.com/2021/10/31/5z70Rx.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-31</div><div class="title">Error Page 设计演示01</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 評論</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/./img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Arvin</div><div class="author-info__description">创造幻想中的故事世界！</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">57</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">標籤</div><div class="length-num">21</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分類</div><div class="length-num">7</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Think-Create-Technology-Studio"><i class="fab fa-github"></i><span>关注我们</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ArvinRoad" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2644266656syx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">创想科技，创造好的游戏（建议采用夜间模式）</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目錄</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%94%E7%A4%BA%E5%9B%BE"><span class="toc-number">1.</span> <span class="toc-text">演示图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%94%E7%A4%BA%E4%BB%A3%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text">演示代码</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/04/20/ThreeJsWebGL_2022_4.20.01/" title="Three.Js开发WebGL地月环绕"><img src="https://pic3.zhimg.com/v2-7af105b5915de8a7fdcf6332b681aba5_r.jpg" onerror="this.onerror=null;this.src='/./img/404.jpg'" alt="Three.Js开发WebGL地月环绕"/></a><div class="content"><a class="title" href="/2022/04/20/ThreeJsWebGL_2022_4.20.01/" title="Three.Js开发WebGL地月环绕">Three.Js开发WebGL地月环绕</a><time datetime="2022-04-20T10:34:00.000Z" title="發表於 2022-04-20 18:34:00">2022-04-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/20/ThreeJsWebGL_2022_4.19.04/" title="Three.Js开发WebGL鼠标操作三维场景"><img src="https://pic3.zhimg.com/v2-7af105b5915de8a7fdcf6332b681aba5_r.jpg" onerror="this.onerror=null;this.src='/./img/404.jpg'" alt="Three.Js开发WebGL鼠标操作三维场景"/></a><div class="content"><a class="title" href="/2022/04/20/ThreeJsWebGL_2022_4.19.04/" title="Three.Js开发WebGL鼠标操作三维场景">Three.Js开发WebGL鼠标操作三维场景</a><time datetime="2022-04-20T07:43:00.000Z" title="發表於 2022-04-20 15:43:00">2022-04-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/19/ThreeJsWebGL_2022_4.19.03/" title="Three.Js开发WebGL动画实现与请求动画帧"><img src="https://pic3.zhimg.com/v2-7af105b5915de8a7fdcf6332b681aba5_r.jpg" onerror="this.onerror=null;this.src='/./img/404.jpg'" alt="Three.Js开发WebGL动画实现与请求动画帧"/></a><div class="content"><a class="title" href="/2022/04/19/ThreeJsWebGL_2022_4.19.03/" title="Three.Js开发WebGL动画实现与请求动画帧">Three.Js开发WebGL动画实现与请求动画帧</a><time datetime="2022-04-19T10:01:00.000Z" title="發表於 2022-04-19 18:01:00">2022-04-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/19/ThreeJsWebGL_2022_4.19.02/" title="Three.Js开发WebGL创建几何体及灯光"><img src="https://pic3.zhimg.com/v2-7af105b5915de8a7fdcf6332b681aba5_r.jpg" onerror="this.onerror=null;this.src='/./img/404.jpg'" alt="Three.Js开发WebGL创建几何体及灯光"/></a><div class="content"><a class="title" href="/2022/04/19/ThreeJsWebGL_2022_4.19.02/" title="Three.Js开发WebGL创建几何体及灯光">Three.Js开发WebGL创建几何体及灯光</a><time datetime="2022-04-19T09:12:00.000Z" title="發表於 2022-04-19 17:12:00">2022-04-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/19/ThreeJsWebGL_2022_4.19.01/" title="Three.Js开发WebGL创建三维空间"><img src="https://pic3.zhimg.com/v2-7af105b5915de8a7fdcf6332b681aba5_r.jpg" onerror="this.onerror=null;this.src='/./img/404.jpg'" alt="Three.Js开发WebGL创建三维空间"/></a><div class="content"><a class="title" href="/2022/04/19/ThreeJsWebGL_2022_4.19.01/" title="Three.Js开发WebGL创建三维空间">Three.Js开发WebGL创建三维空间</a><time datetime="2022-04-19T06:46:00.000Z" title="發表於 2022-04-19 14:46:00">2022-04-19</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://z3.ax1x.com/2021/11/01/IpzNu9.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Arvin</div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=61011602000392"> <img class="icp-icon" src="/img/icp.png"> <span>備案號：陕公网安备 61011602000392号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="閱讀模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="簡繁轉換">繁</button><button id="darkmode" type="button" title="淺色和深色模式轉換"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="單欄和雙欄切換"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="設定"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目錄"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直達評論"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到頂部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜尋</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜尋文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'twikoo-2gpelq3q7fc2f05c',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'twikoo-2gpelq3q7fc2f05c',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script><script src="https://myhkw.cn/api/player/1631371731108" id="myhk" key="1631371731108" m="1"></script><script src="/js/mourning.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script src="//code.tidio.co/7w9ege46jxui0verthfqsrenlqozsnv4.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>